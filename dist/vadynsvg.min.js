!function(){"use strict";var t;function e(){let t={};return window.location.search.slice(window.location.search.indexOf("?")+1).split("&").forEach(e=>{e.includes("=")?t[decodeURIComponent(e.substr(0,e.indexOf("=")))]=decodeURIComponent(e.substr(e.indexOf("=")+1)):t[e]=""}),t}const s={DOLLAR:"NLMNLUSD",EURO:"NLMNLEUR",POUND:"NLMNLGBP",WON:"NLMNLCNY",YEN:"NLMNLJPY"};function n(t){var e=(t=Math.round(t))%3600,s=e%60;return{h:Math.floor(t/3600),m:Math.floor(e/60),s:Math.ceil(s)}}function a(t,e=!1){let a={};return t.columns.forEach(t=>a[t.label]=function(t,e=!1){const a=t.format;if(a){if("number"===t.type){let t={maximumFractionDigits:a.precision,minimumFractionDigits:a.precision};e&&(t.notation="compact",t.maximumSignificantDigits=3);for(let t in s)a.name===t&&(a.name=s[t]);return a.name.startsWith("NLMNI")?{format:e=>{if("number"==typeof e)return a.name.replace("NLMNI","")+new Intl.NumberFormat(navigator.language,t).format(e)}}:a.name.startsWith("TIME")?{format:t=>{if("number"==typeof t){const e=n(t);return(""+e.h).padStart(2,"0")+":"+(""+e.m).padStart(2,"0")+":"+(""+e.s).padStart(2,"0")}return"???"}}:a.name.startsWith("HOUR")?{format:t=>{if("number"==typeof t){const e=Math.floor(t/3600);return new Intl.NumberFormat(navigator.language).format(e)}return"???"}}:a.name.startsWith("HHMM")?{format:t=>{if("number"==typeof t){const e=n(t);return(""+e.h).padStart(2,"0")+":"+(""+e.m).padStart(2,"0")}return"???"}}:a.name.startsWith("MMSS")?{format:t=>{if("number"==typeof t){const e=Math.round(t),s=Math.floor(e/60),n=Math.ceil(e%3600%60);return(""+s).padStart(2,"0")+":"+(""+n).padStart(2,"0")}return"???"}}:(a.name.startsWith("NLMNL")?(t.style="currency",t.currency=a.name.replace("NLMNL","")):a.name.startsWith("PERCENT")?t.style="percent":a.name.startsWith("F")?t.useGrouping=!1:a.name.startsWith("BEST")&&(delete t.maximumFractionDigits,t.maximumSignificantDigits=a.width,e&&(t.maximumSignificantDigits=3)),{format:e=>"number"==typeof e?new Intl.NumberFormat(navigator.language,t).format(e):"???"})}if("date"===t.type)return{format:t=>"string"==typeof t?t:"???"}}return{format:t=>"string"==typeof t?t:"???"}}(t,e)),a}var i;!function(t){t[t.String=0]="String",t[t.Number=1]="Number",t[t.Date=2]="Date"}(i||(i={}));class o{constructor(t,e){this._values=[],this._cols_map=new Map;for(let s=0;s<e.length;s+=1)s<t.length&&(this._values.push(t[s]),this._cols_map.set(e[s],s))}get(t){if("string"!=typeof t)return this._values[t];if(this._cols_map.has(t)){const e=this._cols_map.get(t);if(null!=e)return this._values[e]}}set(t,e){if("string"==typeof t){if(this._cols_map.has(t)){const s=this._cols_map.get(t);null!=s&&(this._values[s]=e)}}else this._values[t]=e}delete(t){if("string"==typeof t){if(this._cols_map.has(t)){const e=this._cols_map.get(t);if(null!=e){this._values.splice(e,1);for(let[t,s]of this._cols_map)s>e&&this._cols_map.set(t,s-1);this._cols_map.delete(t)}}}else if(t>=0&&t<this._values.length){this._values.splice(t,1);const e=Array.from(this._cols_map.keys())[t];for(let[e,s]of this._cols_map)s>t&&this._cols_map.set(e,s-1);this._cols_map.delete(e)}}renameColumn(t,e){if("string"==typeof t){const s=this._cols_map.get(t);void 0!==s&&(this._cols_map.set(e,s),this._cols_map.delete(t))}else{const s=Array.from(this._cols_map.keys())[t];this._cols_map.set(e,t),this._cols_map.delete(s)}}}class r{constructor(t,e){this._rows=[],this._cols=[],this._cols_map=new Map;for(let s of t)this._rows.push(new o(s,e));let s=[];t[0]&&(s=t[0].map(t=>typeof t)),this._cols=e.map((t,e)=>({name:t,type:"string"===s[e]?i.String:i.Number,format:{}})),e.forEach((t,e)=>this._cols_map.set(t,e)),this.calcColumnStats()}get cols(){return Array.from(this._cols_map.keys())}get rows(){return this._rows}get(t,e){const s=this._rows[t],n=this.getColumn(e);if(s&&n)return s.get(n.name)}set(t,e,s){if(t<this._rows.length){const n=this._rows[t],a=this.getColumn(e);a&&n.set(a.name,s)}}getColumn(t,e){if(void 0===e){if("string"!=typeof t)return this._cols[t];if(this._cols_map.has(t)){const e=this._cols_map.get(t);if(null!=e)return this._cols[e]}}else if("number"==typeof t){return this._cols.filter(t=>t.type===e)[t]}}renameColumn(t,e){const s=this.getColumn(t);if(s){const n=this._cols_map.get(s.name);if(void 0!==n){for(let s of this._rows)s.renameColumn(t,e);this._cols_map.set(e,n),this._cols_map.delete(s.name),s.name=e}}}getRow(t){if(t<this._rows.length)return this._rows[t]}getFormatted(t,e,s=!1){const n=this.getColumn(e);if(n){const e=this.get(t,n.name);if(void 0!==e)return s&&n.format.cmp?n.format.cmp?.format(e):n.format.std?n.format.std?.format(e):e.toString()}return"???"}setColumnFormat(t,e,s=!1){const n=this.getColumn(t);n&&(s?n.format.cmp=e:n.format.std=e)}setColumnFormats(t,e,s=!1){for(let n=0;n<t.length;n+=1)n<e.length&&this.setColumnFormat(t[n],e[n],s)}min(t){return this.getColumn(t)?.stats?.min}max(t){return this.getColumn(t)?.stats?.max}sum(t){return this.getColumn(t)?.stats?.sum}avg(t){return this.getColumn(t)?.stats?.avg}calcColumnStats(t=[]){t.length<=0&&(t=this._cols.map(t=>t.name));const e=this._cols.filter(e=>{return t.includes(e.name)&&e.type===i.Number&&!((s=e).stats&&s.stats.manual&&!0===s.stats.manual);var s});e.forEach(t=>t.stats={min:Number.MAX_VALUE,max:Number.MIN_VALUE,sum:0,avg:0});for(let t of this._rows)for(let s of e)if(s&&s.stats){const e=t.get(s.name);e<s.stats.min&&(s.stats.min=e),e>s.stats.max&&(s.stats.max=e),s.stats.sum+=e}for(let t of e)t&&t.stats&&(t.stats.avg=t.stats.sum/this._rows.length)}setColumnStats(t,e){const s=this.getColumn(t);s&&(s.stats||(s.stats={min:Number.MAX_VALUE,max:Number.MIN_VALUE,sum:0,avg:0}),void 0!==e.min&&(s.stats.min=e.min),void 0!==e.max&&(s.stats.max=e.max),void 0!==e.sum&&(s.stats.sum=e.sum),void 0!==e.avg&&(s.stats.avg=e.avg),s.stats.manual=!0)}dropColumn(t){const e=this.getColumn(t);if(e){for(const t of this._rows)t.delete(e.name);const t=this._cols_map.get(e.name);if(null!=t)for(let[e,s]of this._cols_map)s>t&&this._cols_map.set(e,s-1);this._cols_map.delete(e.name),this._cols=this._cols.filter(t=>t.name!==e.name)}}castColumn(t,e){const s=this.getColumn(t);if(s)switch(s.type=e,e){case i.String:for(let t of this._rows)t.set(s.name,String(t.get(s.name)));break;case i.Number:for(let t of this._rows)t.set(s.name,Number(t.get(s.name)));this.calcColumnStats([s.name]);break;case i.Date:}}static fromVA(t){let e=new r(t.data,t.columns.map(t=>t.label));t.columns.forEach(t=>{switch(t.type){case"number":e.castColumn(t.label,i.Number)}});const s=a(t);for(let t in s)e.setColumnFormat(t,s[t]);const n=a(t,!0);for(let t in n)e.setColumnFormat(t,n[t],!0);return e}}const m=/{{([^}]+)}}/g,l=/_x([0-9A-Za-z]+)_/g,c=/(?:^|,)(\w+)(?:$|,)/g,u=/([^:,]+)/g,h=/^[-+]?[0-9]*\.?[0-9]+$/g,f=/^[@#$][0-9]+$/g,p={"@":i.String,"#":i.Number,$:i.Date};function g(t){return"{"+t.replace(c,(function(t,e){return t.replace(e,e+":true")})).replace(u,(function(t,e){return"true"===t||"false"===t||h.test(t)?t:'"'+t+'"'}))+"}"}function d(t){let e={name:"",opts:{}};const s=(t=function(t){return t.replace(l,(function(t,e){return String.fromCharCode(parseInt("0x"+e))}))}(t)).match(m);if(s)if((t=s[0].slice(2,-2)).includes("|")){const s=t.split("|");e.name=s[0],e.opts=JSON.parse(g(s[1]))}else t.includes(":")?e.opts=JSON.parse(g(t)):e.name=t;return e}function _(t){if(t.match(f)){const e=t.charAt(0),s=t.substring(1);if(p.hasOwnProperty(e))return[p[e],Number.parseInt(s)]}}function y(t,e){const s=_(t);let n;if(s){const[t,a]=s;n=e.getColumn(a,t)}else n=e.getColumn(t);return n}class b{constructor(t){this.element=t,this.opts=d(t.id).opts}static getDynamics(t,e=["all"]){return[]}apply(t){}}class w extends b{constructor(t){super(t),this.template=this.element.textContent}static getDynamics(t,e=["all"]){let s=[];return t.querySelectorAll("text").forEach((function(t){t.children.length?s.push(...t.children):s.push(t)})),s=s.filter(t=>t.textContent&&t.textContent.match(m)),s.map(t=>new w(t))}apply(t){this.template&&(this.element.textContent=this.template.replace(m,function(e){const s=d(e),n=_(s.name);let a;if(n){const[e,s]=n;a=t.getColumn(s,e)}else a=t.getColumn(s.name);return a?s.opts.hasOwnProperty("name")&&s.opts.name?a.name:s.opts.hasOwnProperty("c")&&s.opts.c?t.getFormatted(0,a.name,!0):t.getFormatted(0,a.name):"???"}.bind({data:t})))}}class v extends b{constructor(t){super(t),this.orig_bbox=this.element.getBBox(),this.prepElement()}static getDynamics(t,e=["all"]){return Array.from(t.querySelectorAll("g,rect,circle,line")).filter(t=>t.id?.match(m)).map(t=>new v(t))}prepElement(){const t=this.element;this.orig_bbox=t.getBBox(),t.style.transitionProperty="transform, fill, color",t.style.transitionDuration="1s";let e=0,s=0;const n=this.opts["origin"]?.toString().split("-");n&&(n.length>1?(e=Number(n[0]),s=Number(n[1])):e=s=Number(n[0])),e=this.orig_bbox.x+this.orig_bbox.width*e,s=this.orig_bbox.y+this.orig_bbox.height*s,t.style.transformOrigin=e+"px "+s+"px"}apply(t){const e=this.element;let s=[];for(let e of v.transforms){let n;if(this.opts.hasOwnProperty(e.name)?n=e.name:this.opts.hasOwnProperty(e.short)&&(n=e.short),n){const a=y(this.opts[n].toString(),t);if(a?.stats){const n=t.get(0,a.name);if(n){const t=(n-a.stats.min)/(a.stats.max-a.stats.min);s.push(e.get(t,this.opts))}}}}e.style.transform=s.join(" ")}}v.transforms=[{name:"scale",short:"s",get:function(t,e){return"scale("+t+","+t+")"}},{name:"scaleX",short:"sx",get:function(t,e){return"scaleX("+t+")"}},{name:"scaleY",short:"sy",get:function(t,e){return"scaleY("+t+")"}}];const C={version:"1",resultName:"dd91",rowCount:1,availableRowCount:1,data:[["Bead","Dec",112.81571032867849,1329.474768526684]],columns:[{name:"bi100",label:"Department",type:"string"},{name:"bi101",label:"Date",type:"date",usage:"categorical",format:{name:"MONTH",width:3,precision:0,formatString:"MONTH3"}},{name:"bi102",label:"Expenses {{0 1000}}",type:"number",usage:"quantitative",aggregation:"average",format:{name:"DOLLAR",width:15,precision:2,formatString:"DOLLAR15.2"}},{name:"bi103",label:"Revenue {{0.5 4820.50}}",type:"number",usage:"quantitative",aggregation:"average",format:{name:"DOLLAR",width:15,precision:2,formatString:"DOLLAR15.2"}}]};class N extends b{constructor(t){super(t),this.message={resultName:"",version:"",rowCount:0,availableRowCount:0,data:[],columns:[]},this.resultName="",this.data=new r([],[]),this.initComplete=!1,this.instanceSVG="",this.dynamics=[],this.opts={svg:"test.svg",clean:"all",dynamics:"all"},this.init()}init(){var s;this.opts={...this.opts,...e()},fetch(this.opts.svg.toString(),{method:"GET"}).then(t=>t.text()).then(t=>{this.element.innerHTML=t;const e=this.element.querySelector("svg");if(e){!function(t,e=["all"]){(e.includes("all")||e.includes("text"))&&t.querySelectorAll("tspan").forEach((function(t){t.parentElement&&t.parentElement.hasAttribute("x")&&t.removeAttribute("x"),t.parentElement&&t.parentElement.hasAttribute("y")&&t.removeAttribute("y")}))}(e,this.opts.clean.toString().split(","));const t=document.createElementNS("http://www.w3.org/2000/svg","g");t.classList.add("__instance__"),t.id="__instance_0001__",t.append(...[...e.children].filter(t=>"style"!==t.tagName)),e.append(t),this.dynamics=N.getDynamics(t),this.instanceSVG=t.innerHTML}this.initComplete=!0}).catch(t=>console.error("Error: ",t)),s=this.onDataReceived.bind(this),window.addEventListener("message",t=>{t&&t.data&&t.data.hasOwnProperty("data")&&s(t.data)},!1),function(e){const s=document.createEvent("Event");s.initEvent("resizeEndEvent",!1,!0),window.addEventListener("resizeEndEvent",(function(){e()})),window.addEventListener("resize",(function(){t&&clearTimeout(t),t=setTimeout((function(){window.dispatchEvent(s)}),25)}))}(this.draw.bind(this))}static getDynamics(t,e=["all"]){let s=[];return(e.includes("all")||e.includes("text"))&&s.push(...w.getDynamics(t)),(e.includes("all")||e.includes("shapes"))&&s.push(...v.getDynamics(t)),s}apply(){this.initComplete?this.dynamics.forEach(t=>t.apply(this.data)):window.setTimeout(this.apply.bind(this),100)}draw(){}onDataReceived(t){this.message=t,this.resultName=this.message.resultName,this.data=r.fromVA(this.message),this.data=function(t){for(let e of t.cols)if(e.match(m)){const s=t.getColumn(e);if(s){const n=d(e).name.toLowerCase(),a=e.replace(m,"").trim(),i=n.split(" ");if(2===i.length&&i[0].match(h)&&i[0].match(h)){const[e,n]=i.map(Number);t.renameColumn(s.name,a),t.setColumnStats(a,{min:e,max:n})}else{const e=t.getColumn(a);if(e){switch(n){case"min":t.setColumnStats(e.name,{min:s.stats?.min});break;case"max":t.setColumnStats(e.name,{max:s.stats?.max});break;case"sum":t.setColumnStats(e.name,{sum:s.stats?.sum});break;case"avg":t.setColumnStats(e.name,{avg:s.stats?.avg})}t.dropColumn(s.name)}}}}return t}(this.data),this.apply()}}document.addEventListener("DOMContentLoaded",(function(){let t=new N(document.body);(function(){try{return window.self!==window.top}catch(t){return!0}})()||t.onDataReceived(C)}))}();
